<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: ldj-client.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: ldj-client.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>'use strict';

/** -- Sección declarativa del código -- */

/** Variable donde cargamos EventEmitter del módulo events */
const EventEmitter = require('events').EventEmitter;

/** Variable donde cargamos el módulo dev-null */
const devnull = require('dev-null');



/** -- Sección funcional del código -- */

/** 
 * Función auxiliar que comprueba si el string que se le pasa como
 * parámetro está en formato JSON o no, devolviendo true o false
 * @param {string} str - String a comprobar
 */
function isJSON(str) {
    try {
        JSON.parse(str);
    } catch (e) {
        return false;
    }
    return true;
}

/**
 * Clase LDJClient, que hereda de EventEmitter
 */
class LDJClient extends EventEmitter {
    /**
     * Constructor de la clase que recibe un stream
     * @param {stream} stream 
     */
    constructor(stream) {
        super();

        if (stream === null){
            //throw Error('Error: No message specified.');
           // process.stderr  // Se queda colgado
             //   .pipe(devnull())
               // .write('ERROR: No message specifed.\n');
        }
        else {
            let buffer = '';
            stream.on('data', data => {
                buffer += data;
                let boundary = buffer.indexOf('\n');
                while (boundary !== -1) {
                    const input = buffer.substring(0, boundary); // Subcadena desde el inicio a la posición \n
                    buffer = buffer.substring(boundary + 1); // Se quita la subcadena del buffer
                    if (isJSON(input)) {
                        this.emit('message', JSON.parse(input));
                    }
                    else {
                        throw Error('Error: No JSON format.'); 
                    }
                    boundary = buffer.indexOf('\n'); // Siguiente fin de mensaje
                }
                stream.on('close', () => {
                    this.emit('message', JSON.parse(buffer)); 
                });
            });
        }
    }

    /**
     * Método static que evita a los usuarios instanciar la clase
     * @param {stream} stream 
     */
    static connect(stream) {
        return new LDJClient(stream);
    }
}

module.exports = LDJClient;</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Classes</h3><ul><li><a href="LDJClient.html">LDJClient</a></li></ul><h3>Global</h3><ul><li><a href="global.html#devnull">devnull</a></li><li><a href="global.html#EventEmitter">EventEmitter</a></li><li><a href="global.html#isJSON">isJSON</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Mar 12 2019 23:41:27 GMT+0000 (GMT)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
